apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: build-and-deploy-java
spec:
  params:
  - name: build-type
    type: string
    description: "Selected build type: quarkus-jvm, quarkus-fast-jar, quarkus-native, spring-boot"
  - name: deploy-type
    type: string
    description: "Selected deploy type: rolling-replace, blue-green, simple"
  - name: git-repo-url
    type: string
    description: "Git Repository URL"
  - name: git-checkout-sha
    type: string
    description: "Git SHA to checkout"
    default: "main"
  - name: config-git-path
    type: string
    description: "Config Git Path"
    default: "/deploy-config"
  tasks:
  - name: build
    taskRef:
      name: build-java
    params:
    - name: build-type
      value: $(params.build-type)
    - name: git-repo-url
      value: $(params.git-repo-url)
    - name: git-checkout-sha
      value: $(params.git-checkout-sha)
  - name: deploy-rolling-replace
    taskRef:
      name: deploy-rolling-replace
    runAfter:
    - build
    when:
    - input: "$(params.deploy-type)"
      operator: in
      values: ["rolling-replace"]
    params:
    - name: git-repo-url
      value: $(params.git-repo-url)
    - name: git-checkout-sha
      value: $(params.git-checkout-sha)
    - name: config-git-path
      value: $(params.config-git-path)
